# 왜 이렇게 코드를 작성했는가?

## 1. 개요

이 문서는 JWT(JSON Web Token)와 Spring Security를 사용하여 구현된 인증 및 권한 부여 시스템의 설계 및 구현 결정에 대해 설명합니다.

## 2. 기술 스택

*   **Spring Boot:** 애플리케이션의 기본 프레임워크로, 빠르고 간편한 설정과 강력한 기능들을 제공합니다.
*   **Spring Security:** 인증 및 권한 부여를 위한 표준 프레임워크로, 다양한 보안 기능을 제공하며 JWT와 쉽게 통합할 수 있습니다.
*   **JWT (JSON Web Token):** 토큰 기반 인증을 위해 사용되며, 서버와 클라이언트 간에 안전하게 정보를 교환할 수 있게 해줍니다.

## 3. 설계 결정

### 3.1. API 엔드포인트

*   `/api/v1/auth/signup`: 회원가입
*   `/api/v1/auth/login`: 로그인

인증 관련 API는 `/api/v1/auth` 경로에 그룹화하여 관리의 용이성을 높였습니다.

### 3.2. 인증 흐름

#### 3.2.1. 회원가입

1.  사용자는 이메일, 비밀번호, 이름을 제공합니다.
2.  서버는 입력의 유효성을 검사하고 이메일이 이미 사용 중인지 확인합니다.
3.  유효성 검사가 성공하면 서버는 해시된 비밀번호로 새 사용자를 만듭니다.
4.  성공 메시지가 사용자에게 반환됩니다.

#### 3.2.2. 로그인

1.  사용자는 이메일과 비밀번호를 제공합니다.
2.  서버는 입력을 확인하고 해당 이메일을 가진 사용자가 있는지 확인합니다.
3.  사용자가 존재하면 서버는 제공된 비밀번호를 데이터베이스의 해시된 비밀번호와 비교합니다.
4.  비밀번호가 일치하면 서버는 JWT(액세스 토큰 및 새로 고침 토큰)를 생성하여 사용자에게 반환합니다.

### 3.2.3. 로그아웃 (제거됨)

JWT 기반 인증 시스템에서 로그아웃은 주로 클라이언트 측에서 토큰을 삭제하는 방식으로 처리됩니다. 서버 측에서 토큰을 무효화하는 로직이 필요한 경우 (예: Refresh Token 무효화, 블랙리스트 추가 등), 이는 일반적으로 클라이언트가 명시적으로 호출하는 `/logout` 엔드포인트보다는 토큰 갱신 과정의 일부로 또는 특정 보안 요구 사항에 따라 내부적으로 처리됩니다. 따라서 명시적인 `/api/v1/auth/logout` 엔드포인트는 제거되었습니다.

### 3.3. DTO (Data Transfer Objects)

Lombok 어노테이션을 사용하지 않고 `getter`, `setter` 및 생성자를 수동으로 생성하여 코드의 명확성과 일관성을 유지했습니다.

### 3.4. `User` Entity

`User` 엔티티는 `roles` 필드를 포함하도록 수정되어 역할 기반 접근 제어를 지원합니다. 사용자가 가입하면 기본적으로 "ROLE_USER" 역할이 할당됩니다.

### 3.5. Spring Security 및 JWT 구성

*   **`SecurityConfig`:** `authorizeHttpRequests`를 수정하여 새로운 인증 엔드포인트에 대한 접근을 허용했습니다.
*   **`JwtTokenProvider`:** 역할을 처리하도록 수정되었습니다. `createToken` 메소드는 이제 클레임에 역할을 포함하고, `getAuthentication` 메소드는 클레임에서 역할을 추출하여 `SimpleGrantedAuthority` 목록을 생성합니다.
*   **`JwtAuthenticationFilter`:** 모든 요청에서 JWT 토큰의 유효성을 검사하고 `SecurityContext`에 인증 정보를 저장합니다.

## 4. 결론

이러한 설계 결정은 확장 가능하고 안전하며 유지보수하기 쉬운 인증 시스템을 만들기 위해 내려졌습니다. 코드를 명확하고 일관성 있게 유지함으로써 향후 개발자가 시스템을 더 쉽게 이해하고 작업할 수 있도록 했습니다.
