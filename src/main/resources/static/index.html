<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shortudy - ìˆí¼ í•™ìŠµ í”Œë«í¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #0f0f0f;
            color: #fff;
            min-height: 100vh;
        }

        /* í—¤ë” */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 1000;
            border-bottom: 1px solid #333;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #ff4757;
            text-decoration: none;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #333;
            border-radius: 20px;
            padding: 8px 16px;
            width: 400px;
        }

        .search-box input {
            background: transparent;
            border: none;
            color: #fff;
            width: 100%;
            font-size: 14px;
            outline: none;
        }

        .search-box button {
            background: transparent;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 18px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #ff4757;
            color: #fff;
        }

        .btn-primary:hover {
            background: #ff6b7a;
        }

        .btn-secondary {
            background: #333;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: #1a1a1a;
            border-radius: 12px;
            padding: 8px 0;
            min-width: 200px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            display: none;
        }

        .user-dropdown.active {
            display: block;
        }

        .user-dropdown a {
            display: block;
            padding: 12px 20px;
            color: #fff;
            text-decoration: none;
            transition: background 0.2s;
        }

        .user-dropdown a:hover {
            background: #333;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            position: fixed;
            left: 0;
            top: 60px;
            bottom: 0;
            width: 240px;
            background: #1a1a1a;
            padding: 16px 0;
            overflow-y: auto;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 24px;
            color: #fff;
            text-decoration: none;
            transition: background 0.2s;
        }

        .sidebar-item:hover, .sidebar-item.active {
            background: #333;
        }

        .sidebar-item .icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .sidebar-divider {
            height: 1px;
            background: #333;
            margin: 12px 0;
        }

        .sidebar-title {
            padding: 12px 24px;
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            margin-left: 240px;
            margin-top: 60px;
            padding: 24px;
        }

        /* ì¹´í…Œê³ ë¦¬ í•„í„° */
        .category-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .category-chip {
            padding: 8px 16px;
            background: #333;
            border-radius: 20px;
            color: #fff;
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .category-chip:hover, .category-chip.active {
            background: #fff;
            color: #000;
        }

        /* ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .video-card {
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .video-card:hover {
            transform: translateY(-4px);
        }

        .video-thumbnail {
            position: relative;
            aspect-ratio: 9/16;
            background: #333;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .video-info {
            padding: 12px;
        }

        .video-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #888;
            font-size: 12px;
        }

        .video-uploader {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .uploader-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .video-tags {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 2px 8px;
            background: #333;
            border-radius: 4px;
            font-size: 11px;
            color: #aaa;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
            .search-box {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <a href="index.html" class="logo">ğŸ“š Shortudy</a>

        <div class="search-box">
            <input type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." id="searchInput">
            <button onclick="search()">ğŸ”</button>
        </div>

        <div class="header-actions">
            <a href="upload.html" class="btn btn-primary">+ ì—…ë¡œë“œ</a>
            <div class="user-menu">
                <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar">G</div>
                <div class="user-dropdown" id="userDropdown">
                    <a href="mypage.html">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</a>
                    <a href="my-shorts.html">ğŸ¬ ë‚´ ì˜ìƒ</a>
                    <a href="settings.html">âš™ï¸ ì„¤ì •</a>
                    <a href="#" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </div>
            <div id="authButtons" style="display: none;">
                <a href="login.html" class="btn btn-secondary">ë¡œê·¸ì¸</a>
                <a href="signup.html" class="btn btn-primary">íšŒì›ê°€ì…</a>
            </div>
        </div>
    </header>

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
        <a href="index.html" class="sidebar-item active">
            <span class="icon">ğŸ </span>
            <span>í™ˆ</span>
        </a>
        <a href="trending.html" class="sidebar-item">
            <span class="icon">ğŸ”¥</span>
            <span>ì¸ê¸°</span>
        </a>
        <a href="latest.html" class="sidebar-item">
            <span class="icon">â°</span>
            <span>ìµœì‹ </span>
        </a>

        <div class="sidebar-divider"></div>
        <div class="sidebar-title">ì¹´í…Œê³ ë¦¬</div>

        <a href="category.html?id=1" class="sidebar-item">
            <span class="icon">ğŸ’»</span>
            <span>í”„ë¡œê·¸ë˜ë°</span>
        </a>
        <a href="category.html?id=2" class="sidebar-item">
            <span class="icon">ğŸ¨</span>
            <span>ë””ìì¸</span>
        </a>
        <a href="category.html?id=3" class="sidebar-item">
            <span class="icon">ğŸ“ˆ</span>
            <span>ë§ˆì¼€íŒ…</span>
        </a>

        <div class="sidebar-divider"></div>
        <div class="sidebar-title">ë‚´ ì½˜í…ì¸ </div>

        <a href="my-shorts.html" class="sidebar-item">
            <span class="icon">ğŸ¬</span>
            <span>ë‚´ ì˜ìƒ</span>
        </a>
        <a href="liked.html" class="sidebar-item">
            <span class="icon">â¤ï¸</span>
            <span>ì¢‹ì•„ìš”</span>
        </a>
        <a href="history.html" class="sidebar-item">
            <span class="icon">ğŸ“œ</span>
            <span>ì‹œì²­ ê¸°ë¡</span>
        </a>
    </aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
        <div class="category-filter">
            <a href="#" class="category-chip active">ì „ì²´</a>
            <a href="#" class="category-chip">í”„ë¡œê·¸ë˜ë°</a>
            <a href="#" class="category-chip">ë””ìì¸</a>
            <a href="#" class="category-chip">ë§ˆì¼€íŒ…</a>
            <a href="#" class="category-chip">Java</a>
            <a href="#" class="category-chip">Spring Boot</a>
            <a href="#" class="category-chip">React</a>
            <a href="#" class="category-chip">Python</a>
            <a href="#" class="category-chip">UI/UX</a>
        </div>

        <!-- ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ -->
        <div class="video-grid" id="videoGrid">
            <!-- ë¹„ë””ì˜¤ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>

        <!-- ë¡œë”© í‘œì‹œ -->
        <div id="loading" style="text-align: center; padding: 40px; display: none;">
            <p>ë¡œë”© ì¤‘...</p>
        </div>
    </main>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        let currentPage = 0;
        let isLoading = false;

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadShorts();
            loadCategories();
        });

        // ì¸ì¦ ìƒíƒœ í™•ì¸
        async function checkAuth() {
            const token = localStorage.getItem('accessToken');
            if (token) {
                try {
                    const res = await fetch(`${API_BASE}/auth/stat`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const data = await res.json();
                    if (data.isLoggedIn) {
                        document.getElementById('userAvatar').textContent = data.name.charAt(0);
                        document.getElementById('authButtons').style.display = 'none';
                        document.querySelector('.user-menu').style.display = 'block';
                    } else {
                        showAuthButtons();
                    }
                } catch (e) {
                    showAuthButtons();
                }
            } else {
                showAuthButtons();
            }
        }

        function showAuthButtons() {
            document.getElementById('authButtons').style.display = 'flex';
            document.querySelector('.user-menu').style.display = 'none';
        }

        // ìˆí¼ ëª©ë¡ ë¡œë“œ
        async function loadShorts(page = 0) {
            if (isLoading) return;
            isLoading = true;
            document.getElementById('loading').style.display = 'block';

            try {
                const res = await fetch(`${API_BASE}/shorts?page=${page}&size=12`);
                const data = await res.json();
                console.log('ìˆí¼ ëª©ë¡ ì‘ë‹µ:', data);

                let shorts = [];
                // ApiResponseë¡œ ê°ì‹¼ ê²½ìš°
                if (data.success && data.data && data.data.content) {
                    shorts = data.data.content;
                }
                // Page ê°ì²´ ì§ì ‘ ë°˜í™˜í•œ ê²½ìš°
                else if (data.content) {
                    shorts = data.content;
                }
                // ë°°ì—´ì¸ ê²½ìš°
                else if (Array.isArray(data)) {
                    shorts = data;
                }

                if (shorts.length > 0) {
                    renderShorts(shorts, page === 0);
                    currentPage = page;
                } else if (page === 0) {
                    // ì²« í˜ì´ì§€ì¸ë° ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë”ë¯¸ ë°ì´í„° í‘œì‹œ
                    renderDummyShorts();
                }
            } catch (e) {
                console.error('Failed to load shorts:', e);
                // ë”ë¯¸ ë°ì´í„°ë¡œ ë Œë”ë§
                renderDummyShorts();
            } finally {
                isLoading = false;
                document.getElementById('loading').style.display = 'none';
            }
        }

        // ìˆí¼ ë Œë”ë§
        function renderShorts(shorts, clear = false) {
            const grid = document.getElementById('videoGrid');
            if (clear) grid.innerHTML = '';

            shorts.forEach(short => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => location.href = `watch.html?id=${short.shortsId}`;

                card.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${short.thumbnailUrl || 'https://via.placeholder.com/300x533/333/fff?text=No+Thumbnail'}" alt="${short.title}">
                        <span class="video-duration">${formatDuration(short.durationSec)}</span>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${short.title}</h3>
                        <div class="video-meta">
                            <div class="video-uploader">
                                <div class="uploader-avatar"></div>
                                <span>${short.uploaderNickname || 'ìµëª…'}</span>
                            </div>
                            <span>â€¢</span>
                            <span>${short.categoryName}</span>
                        </div>
                        <div class="video-tags">
                            ${(short.tagNames || []).slice(0, 3).map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // ë”ë¯¸ ë°ì´í„°
        function renderDummyShorts() {
            const dummyData = [
                { shortsId: 1, title: 'Spring Boot ì‹œì‘í•˜ê¸° - ì…ë¬¸ìë¥¼ ìœ„í•œ ì™„ë²½ ê°€ì´ë“œ', uploaderNickname: 'ê°œë°œí•˜ëŠ”ì •ëŒ€ë¦¬', categoryName: 'í”„ë¡œê·¸ë˜ë°', durationSec: 58, tagNames: ['Java', 'Spring'] },
                { shortsId: 2, title: 'React Hooks ì™„ë²½ ì •ë¦¬ - useStateë¶€í„° useEffectê¹Œì§€', uploaderNickname: 'ì½”ë”©ì• í”Œ', categoryName: 'í”„ë¡œê·¸ë˜ë°', durationSec: 45, tagNames: ['React', 'JavaScript'] },
                { shortsId: 3, title: 'Figma ê¸°ì´ˆ - UI ë””ìì¸ ì‹œì‘í•˜ê¸°', uploaderNickname: 'ë””ìì¸ë² ì´ìŠ¤', categoryName: 'ë””ìì¸', durationSec: 60, tagNames: ['Figma', 'UI/UX'] },
                { shortsId: 4, title: 'JPA N+1 ë¬¸ì œ í•´ê²°í•˜ê¸°', uploaderNickname: 'ìš°ì•„í•œí˜•ì œë“¤', categoryName: 'í”„ë¡œê·¸ë˜ë°', durationSec: 55, tagNames: ['JPA', 'Spring'] },
                { shortsId: 5, title: 'Git ë¸Œëœì¹˜ ì „ëµ - GitFlow vs Trunk', uploaderNickname: 'ë…¸ë§ˆë“œì½”ë”', categoryName: 'í”„ë¡œê·¸ë˜ë°', durationSec: 42, tagNames: ['Git', 'DevOps'] },
                { shortsId: 6, title: 'ë§ˆì¼€íŒ… í¼ë„ ì„¤ê³„í•˜ê¸°', uploaderNickname: 'ë§ˆì¼€í„°ë°•', categoryName: 'ë§ˆì¼€íŒ…', durationSec: 50, tagNames: ['ë§ˆì¼€íŒ…', 'í¼ë„'] },
            ];
            renderShorts(dummyData, true);
        }

        // ì¹´í…Œê³ ë¦¬ ë¡œë“œ
        async function loadCategories() {
            try {
                const res = await fetch(`${API_BASE}/categories`);
                const data = await res.json();
                // ì¹´í…Œê³ ë¦¬ ë Œë”ë§ (í•„ìš”ì‹œ)
            } catch (e) {
                console.error('Failed to load categories:', e);
            }
        }

        // ì‹œê°„ í¬ë§·
        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // ê²€ìƒ‰
        function search() {
            const query = document.getElementById('searchInput').value;
            if (query) {
                location.href = `search.html?q=${encodeURIComponent(query)}`;
            }
        }

        // ì—”í„°í‚¤ ê²€ìƒ‰
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') search();
        });

        // ìœ ì € ë©”ë‰´ í† ê¸€
        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('active');
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            location.reload();
        }

        // í´ë¦­ ì™¸ë¶€ ì˜ì—­ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userDropdown').classList.remove('active');
            }
        });

        // ë¬´í•œ ìŠ¤í¬ë¡¤
        window.addEventListener('scroll', () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                loadShorts(currentPage + 1);
            }
        });
    </script>
</body>
</html>

